<!DOCTYPE html>
<html>
<head>
<title>csv2table</title>

<script src="lib/jquery-3.1.1.min.js"></script>

<style>
table.resultTable th{
	border:1px solid black;
}
table.resultTable td{
	border:1px solid black;
}

</style>
</head>
<body>

<div>

<input type="text" class="csvText" style="width:100%">
<input type="button" class="btnConvert" value="Convert">
</div> 
<div class="tableArea">
	<p>Table area</p>
	<form class="tableForm">
		<table class="resultTable"><tr class="hiddenEnd"></tr></table>
	</form>
</div>
<script>
// ==================== jQuery ==================

//$.noConflict();
function string2array(string,delim=','){
	var arr = string.split(delim)
	var arr2 = [];
	var strBuilder = "";
	for(var i=0;i<arr.length;i++){
		if(arr[i].startsWith("'")){    //1,',,,,,','par1,,,par2,,,par3,,,,',''''''''''',',,'  => 1   ',,,,,'   'par1,,,par2,,,par3,,,,'   '''''''''''    ',,'
			if(arr[i].endsWith("'") && arr[i].length > 1){	arr2.push(arr[i]); }			
			else{	
				strBuilder=arr[i];				
				i++;
				if(i<arr.length){
					strBuilder+=delim+arr[i];
				}	
				while(!strBuilder.endsWith("'") && ++i < arr.length){				
					strBuilder+=delim+arr[i];					
				}
				arr2.push(strBuilder);
				strBuilder="";
			}
		}
		else if(arr[i].startsWith("to_timestamp(")){ 
			strBuilder+=arr[i]
			while(!strBuilder.endsWith(")") && ++i<arr.length){
				strBuilder+=delim+arr[i]
			}
			arr2.push(strBuilder);
			strBuilder="";
		}
		else{arr2.push(arr[i])}
	}
	return arr2
}

function stringOfColumns2htm(stringOfColumns, isTd){
	return array2row(string2array(stringOfColumns),isTd);
}
function array2row(array,isTd=true){
	var htm="";	
	switch(isTd){case false: for(var i=0;i<array.length;i++){htm+='<th>'+array[i]+'</th>'};htm='<tr><th></th>'+htm+'</tr>';break;
							    default: for(var i=0;i<array.length;i++){htm+='<td>'+array[i]+'</td>'};htm='<tr><td></td>'+htm+'</tr>';break; }	
	return htm;
}

function log(str){ console.log(str); }
var tableList = [];

function sqlParser(){

	this.insertPtn = /^INSERT\s{1,}INTO\s.*[)]\s*VALUES\s*[(].*$/i;
	// can add updatePtn, deletePtn
  this.commandInsertHeadPtn=/^INSERT\sINTO\s*/i
  this.tableNamePtn=/^[^,]+[(]/gi
  this.commandMidValuesPtn = /[)]\s*values\s*[(]/gi
  this.commandEndPtn = /[)][;]\s*$/g
  this.sqlCommand = "";
  this.tableName = "";
  this.hColumns = "";
  this.rColumns = "";
  this.parse = function(sqlString){
        if(this.insertPtn.test(sqlString)){
      	this.sqlCommand = sqlString.match(this.commandInsertHeadPtn);
      	var tableName_NRest = sqlString.substring(this.sqlCommand.toString().length);
      	this.tableName = tableName_NRest.match(this.tableNamePtn);

      	var hColumns_NRest = tableName_NRest.substring(this.tableName.toString().length);
      	this.commandMidValuesPtn.test(hColumns_NRest)
      	this.hColumns = hColumns_NRest.substring(0,this.commandMidValuesPtn.lastIndex)
      	this.rColumns = hColumns_NRest.substring(this.commandMidValuesPtn.lastIndex)

      	var lenToDump = this.hColumns.match(this.commandMidValuesPtn).toString().length
      	var hlen = this.hColumns.toString().length;
      	this.hColumns = this.hColumns.toString().substring(0, hlen-lenToDump).trim();        	

      	var lenToDump = this.rColumns.match(this.commandEndPtn).pop().toString().length;
      	var rlen = this.rColumns.toString().length;
      	this.rColumns = this.rColumns.toString().substring(0,rlen-lenToDump).trim();

      	// final vars
      	this.sqlCommand = this.sqlCommand.toString().trim();
      	this.tableName = cleanBracketString(this.tableName);      	
      }
      // can add updatePtn, deletePtn
  }


}
$(function(){    
    
    $('input.btnConvert').click(function(){

        var txt = $('input.csvText').val();
        var parser = new sqlParser();
        parser.parse(txt);
        $('tr.hiddenEnd').before(stringOfColumns2htm(parser.hColumns,false));
        $('tr.hiddenEnd').before(stringOfColumns2htm(parser.rColumns,true));

    });
   

});
function cleanBracketString(string){
	var stringBuilder=string.toString().trim();
	stringBuilder=stringBuilder.replace(/[()]/g, "");
 	return stringBuilder.toString().trim();
}


</script>
</body>
</html>