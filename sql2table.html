<!DOCTYPE html>
<html>
<head>
<title>csv2table</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<style>
table.resultTable th{
	border:1px solid black;
}
table.resultTable td{
	border:1px solid black;
}

</style>
</head>
<body>

<div>

<input type="text" class="csvText" style="width:100%">
<input type="button" class="btnConvert" value="Convert">
</div> 
<div class="tableArea">
	<p>Table area</p>
	<form class="tableForm">
		<table class="resultTable"><tr class="hiddenEnd"></tr></table>
	</form>
</div>
<script>
// ==================== jQuery ==================

//$.noConflict();
function string2array(string,delim=','){
	var arr = string.split(delim)
	var arr2 = [];
	var strBuilder = "";
	for(var i=0;i<arr.length;i++){
		if(arr[i].startsWith("'")){    //1,',,,,,','par1,,,par2,,,par3,,,,',''''''''''',',,'  => 1   ',,,,,'   'par1,,,par2,,,par3,,,,'   '''''''''''    ',,'
			if(arr[i].endsWith("'") && arr[i].length > 1){	arr2.push(arr[i]); }			
			else{	
				strBuilder=arr[i];				
				i++;
				if(i<arr.length){
					strBuilder+=delim+arr[i];
				}	
				while(!strBuilder.endsWith("'") && ++i < arr.length){				
					strBuilder+=delim+arr[i];					
				}
				arr2.push(strBuilder);
				strBuilder="";
			}
		}
		else if(arr[i].startsWith("to_timestamp(")){ 
			strBuilder+=arr[i]
			while(!strBuilder.endsWith(")") && ++i<arr.length){
				strBuilder+=delim+arr[i]
			}
			arr2.push(strBuilder);
			strBuilder="";
		}
		else{arr2.push(arr[i])}
	}
	return arr2
}

function stringOfColumns2htm(stringOfColumns, isTd){
	return array2row(string2array(stringOfColumns),isTd);
}
function array2row(array,isTd=true){
	var htm="";	
	switch(isTd){case false: for(var i=0;i<array.length;i++){htm+='<th>'+array[i]+'</th>'};htm='<tr><th></th>'+htm+'</tr>';break;
							    default: for(var i=0;i<array.length;i++){htm+='<td>'+array[i]+'</td>'};htm='<tr><td></td>'+htm+'</tr>';break; }	
	return htm;
}

function log(str){ console.log(str); }
var tableList = [];

function sqlParser(sqlString){

	this.insertPtn = /^INSERT\s{1,}INTO\s.*[)]\s*VALUES\s*[(].*$/i;
  this.commandInsertHeadPtn=/^INSERT\sINTO\s*/i
  this.tableNamePtn=/^[^,]+[(]/gi
  this.commandMidValuesPtn = /[)]\s*values\s*[(]/gi
  this.commandEndPtn = /[)][;]\s*$/g
  this.sqlCommand = "";
  this.tableName = "";
  this.hColumns = "";
  this.rColumns = "";
  this.parse = function(){
        if(insertPtn.test(sqlString)){
      	this.sqlCommand = sqlString.match(commandInsertHeadPtn);
      	var tableName_NRest = sqlString.substring(this.sqlCommand.toString().length);
      	this.tableName = tableName_NRest.match(tableNamePtn);

      	var hColumns_NRest = tableName_NRest.substring(this.tableName.toString().length);
      	commandMidValuesPtn.test(hColumns_NRest)
      	this.hColumns = hColumns_NRest.substring(0,commandMidValuesPtn.lastIndex)
      	this.rColumns = hColumns_NRest.substring(commandMidValuesPtn.lastIndex)

      	var lenToDump = this.hColumns.match(commandMidValuesPtn).toString().length
      	var hlen = this.hColumns.toString().length;
      	this.hColumns = this.hColumns.toString().substring(0, hlen-lenToDump).trim();        	

      	var lenToDump = this.rColumns.match(commandEndPtn).pop().toString().length;
      	var rlen = this.rColumns.toString().length;
      	this.rColumns = this.rColumns.toString().substring(0,rlen-lenToDump).trim();

      	// final vars
      	this.sqlCommand = this.sqlCommand.toString().trim();
      	this.tableName = cleanBracketString(this.tableName);
      	
      }

  }


}
$(function(){    
    
    $('input.btnConvert').click(function(){

        var txt = $('input.csvText').val();
        var insertPtn = /^INSERT\s{1,}INTO\s.*[)]\s*VALUES\s*[(].*$/i;
        var commandHeadPtn=/^INSERT\sINTO\s*/i
        var tableNamePtn=/^[^,]+[(]/gi
        var commandMidValuesPtn = /[)]\s*values\s*[(]/gi
        var commandEndPtn = /[)][;]\s*$/g
        if(insertPtn.test(txt)){
        	var sqlCommand = txt.match(commandHeadPtn);
        	var tableName_NRest = txt.substring(sqlCommand.toString().length);
        	var tableName = tableName_NRest.match(tableNamePtn);

        	var hColumns_NRest = tableName_NRest.substring(tableName.toString().length);
        	commandMidValuesPtn.test(hColumns_NRest)
        	var hColumns = hColumns_NRest.substring(0,commandMidValuesPtn.lastIndex)
        	var rColumns = hColumns_NRest.substring(commandMidValuesPtn.lastIndex)

        	var lenToDump = hColumns.match(commandMidValuesPtn).toString().length
        	var hlen = hColumns.toString().length;
        	hColumns = hColumns.toString().substring(0, hlen-lenToDump).trim();        	

        	var lenToDump = rColumns.match(commandEndPtn).pop().toString().length;
        	var rlen = rColumns.toString().length;
        	rColumns = rColumns.toString().substring(0,rlen-lenToDump).trim();

        	// final vars
        	sqlCommand = sqlCommand.toString().trim();
        	tableName = cleanBracketString(tableName);
        	//hColumns, rColumns
        	
        }

        $('tr.hiddenEnd').before(stringOfColumns2htm(txt,true));
    });
   

});
function cleanBracketString(string){
	var stringBuilder=string.toString().trim();
	stringBuilder=stringBuilder.replace(/[()]/g, "");
 	return stringBuilder.toString().trim();
}


</script>
</body>
</html>